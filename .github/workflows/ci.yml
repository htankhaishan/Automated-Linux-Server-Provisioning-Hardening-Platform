security:
  name: Security Scanning
  runs-on: ubuntu-latest

  steps:
    - name: Checkout code
      uses: actions/checkout@v4

    # --- tfsec Security Scan ---
    - name: Run tfsec
      uses: aquasecurity/tfsec-action@v1.0.3
      with:
        directory: terraform

    # --- Checkov Security Scan ---
    - name: Run Checkov
      uses: bridgecrewio/checkov-action@v12
      with:
        directory: terraform

    # --- Trivy Infrastructure as Code Scan ---
    - name: Run Trivy IaC Scan
      uses: aquasecurity/trivy-action@v0.20.0
      with:
        scan-type: fs
        scan-ref: .
        severity: CRITICAL,HIGH